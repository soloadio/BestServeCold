<div class="relative">
  <app-navbar></app-navbar>
  <div class="flex flex-col min-w-dvw min-h-dvh px-5 sm:px-20 md:px-30 lg:px-50 mt-10">
    <div class="absolute top-4 right-4 z-50" *ngIf="loading">
      <div
        class="max-w-xs bg-white border border-gray-200 rounded-xl shadow-lg dark:bg-neutral-800 dark:border-neutral-700"
        role="alert"
        tabindex="-1"
        aria-labelledby="hs-toast-stack-toggle-update-label"
      >
        <div class="flex p-4">
          <div class="shrink-0">
            <svg
              class="shrink-0 size-4 text-teal-500 mt-0.5"
              xmlns="http://www.w3.org/2000/svg"
              width="16"
              height="16"
              fill="currentColor"
              viewBox="0 0 16 16"
            >
              <path
                d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z"
              ></path>
            </svg>
          </div>
          <div class="ms-3">
            <p
              id="hs-toast-stack-toggle-update-label"
              class="text-sm text-gray-700 dark:text-neutral-400"
            >
              Loading batch, please wait.
            </p>
          </div>
        </div>
      </div>
    </div>
    <div class="absolute top-4 right-4 z-50" *ngIf="error">
      <div
        class="max-w-xs bg-white border border-gray-200 rounded-xl shadow-lg dark:bg-neutral-800 dark:border-neutral-700"
        role="alert"
        tabindex="-1"
        aria-labelledby="hs-toast-stack-toggle-update-label"
      >
        <div class="flex p-4">
          <div class="shrink-0">
            <svg class="shrink-0 size-4 text-red-500 mt-0.5" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
              <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM5.354 4.646a.5.5 0 1 0-.708.708L7.293 8l-2.647 2.646a.5.5 0 0 0 .708.708L8 8.707l2.646 2.647a.5.5 0 0 0 .708-.708L8.707 8l2.647-2.646a.5.5 0 0 0-.708-.708L8 7.293 5.354 4.646z"></path>
            </svg>
          </div>
          <div class="ms-3">
            <p
              id="hs-toast-stack-toggle-update-label"
              class="text-sm text-gray-700 dark:text-neutral-400"
            >
              There was an issue processing your request, please try again.
            </p>
          </div>
        </div>
      </div>
    </div>


    <div class="absolute top-4 right-4 z-50" *ngIf="sent">
      <div
        class="max-w-xs bg-white border border-gray-200 rounded-xl shadow-lg dark:bg-neutral-800 dark:border-neutral-700"
        role="alert"
        tabindex="-1"
        aria-labelledby="hs-toast-stack-toggle-update-label"
      >
        <div class="flex p-4">
          <div class="shrink-0">
            <svg
              class="shrink-0 size-4 text-teal-500 mt-0.5"
              xmlns="http://www.w3.org/2000/svg"
              width="16"
              height="16"
              fill="currentColor"
              viewBox="0 0 16 16"
            >
              <path
                d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z"
              ></path>
            </svg>
          </div>
          <div class="ms-3">
            <p
              id="hs-toast-stack-toggle-update-label"
              class="text-sm text-gray-700 dark:text-neutral-400"
            >
              Email has been drafted!
            </p>
          </div>
        </div>
      </div>
    </div>
    <div class="absolute top-4 right-4 z-50" *ngIf="senderror">
      <div
        class="max-w-xs bg-white border border-gray-200 rounded-xl shadow-lg dark:bg-neutral-800 dark:border-neutral-700"
        role="alert"
        tabindex="-1"
        aria-labelledby="hs-toast-stack-toggle-update-label"
      >
        <div class="flex p-4">
          <div class="shrink-0">
            <svg class="shrink-0 size-4 text-red-500 mt-0.5" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
              <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM5.354 4.646a.5.5 0 1 0-.708.708L7.293 8l-2.647 2.646a.5.5 0 0 0 .708.708L8 8.707l2.646 2.647a.5.5 0 0 0 .708-.708L8.707 8l2.647-2.646a.5.5 0 0 0-.708-.708L8 7.293 5.354 4.646z"></path>
            </svg>
          </div>
          <div class="ms-3">
            <p
              id="hs-toast-stack-toggle-update-label"
              class="text-sm text-gray-700 dark:text-neutral-400"
            >
              There was an issue processing your email, please try again.
            </p>
          </div>
        </div>
      </div>
    </div>
    <!-- Dashboard Button -->
    <div class="flex flex-row justify-center mb-6 gap-4">
      <button class="btn btn-outline btn-primary" (click)="returnToDashboard()">Return to Dashboard</button>
      <button class="btn btn-outline btn-primary" (click)="draftAllEmail()">Draft All to Gmail</button>
    </div>

    <!-- Centered content wrapper -->
    <div class="flex flex-col items-center w-full">
      <ul class="flex flex-col justify-center items-center gap-6 w-full max-w-6xl list-none">
        <!-- List Title -->
        <h2 class="p-4 pb-2 opacity-60 tracking-wide text-center prose lg:prose-xl">
          {{res.user_full_name}}'s Generated Drafts {{ res.created_at | date:'medium' }}
        </h2>

        <!-- Individual Draft Card -->
        <li *ngFor="let draft of res.drafts; let i = index"
            class="bg-base-100 rounded-xl shadow-lg p-6 border border-base-300 w-full">
          
          <!-- HEADER ROW: Count, Name, Email, Buttons -->
          <div class="flex items-center justify-between pb-4 border-b border-base-300">
            <div class="flex items-center gap-4">
              <div class="text-3xl font-thin opacity-40 tabular-nums">{{i + 1}}</div>
              <div class="flex flex-col">
                <p class="font-medium">
                  {{draft.name}} â€” <span class="opacity-70">{{draft.email}}</span>
                </p>
                <a class="text-primary underline opacity-70 break-all text-sm" [href]="draft.url">{{draft.url}}</a>
              </div>
            </div>

            <!-- Action Buttons -->
            <div class="flex gap-4">
              <div class="tooltip tooltip-primary">
                <div class="tooltip-content">Draft Gmail</div>
                <button class="btn btn-square btn-ghost" (click)="draftEmail(draft)">
                  <svg class="size-[1.4em]" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <g stroke-linejoin="round" stroke-linecap="round" stroke-width="2" fill="none" stroke="currentColor">
                      <path d="M6 3L20 12 6 21 6 3z"></path>
                    </g>
                  </svg>
                </button>
              </div>

              <div class="tooltip tooltip-primary">
                <div class="tooltip-content">Copy Email</div>
                <button class="btn btn-square btn-ghost" (click)="copyEmail(draft)">
                  <svg class="size-[1.4em]" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <g stroke-linejoin="round" stroke-linecap="round" stroke-width="2" fill="none" stroke="currentColor">
                      <path d="M8 3H19V16H8V3Z"></path>
                      <path d="M5 7H4a1 1 0 0 0-1 1v13a1 1 0 0 0 1 1h13a1 1 0 0 0 1-1v-1"></path>
                    </g>
                  </svg>
                </button>
              </div>
            </div>
          </div>

          <!-- EMAIL CONTENT BELOW -->
          <div class="flex justify-center pt-4">
            <div class="space-y-4 w-full max-w-3xl prose lg:prose-xl">
              <h3 class="text-lg font-semibold">Subject: {{draft.content.subject}}</h3>
              <h4>{{draft.content.greeting}}</h4>
              <p>{{draft.content.paragraph1}}</p>
              <p>{{draft.content.paragraph2}}</p>
              <p>{{draft.content.paragraph3}}</p>
              <h4>{{draft.content.closing}}</h4>
              <h4>{{res.user_full_name}}</h4>
            </div>
          </div>
        </li>
      </ul>
    </div>
  </div>

</div>